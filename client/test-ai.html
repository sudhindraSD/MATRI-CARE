<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATRI-CARE AI Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .result { background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #fee; color: red; }
        .success { background: #efe; color: green; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ü§ñ MATRI-CARE AI Integration Test</h1>
    
    <div class="test-section">
        <h2>üîë API Key Status</h2>
        <div id="apiKeyStatus">Checking...</div>
    </div>
    
    <div class="test-section">
        <h2>üß™ Test Gemini API Call</h2>
        <button onclick="testGeminiAPI()">Test Gemini Integration</button>
        <div id="geminiResult"></div>
    </div>
    
    <div class="test-section">
        <h2>ü§∞ Test Pregnancy Chatbot</h2>
        <input type="text" id="testQuestion" placeholder="Ask a pregnancy question..." style="width: 70%; padding: 8px;">
        <button onclick="testChatbot()">Ask Chatbot</button>
        <div id="chatbotResult"></div>
    </div>

    <script>
        // Environment variable check
        function checkAPIKey() {
            const geminiKey = 'AIzaSyB4hlnDPViOskpseVwHzi-JaO1UOFJqOWo';
            const statusDiv = document.getElementById('apiKeyStatus');
            
            if (geminiKey && geminiKey !== 'your_gemini_api_key_here') {
                statusDiv.innerHTML = '<div class="result success">‚úÖ Gemini API Key Found: ' + geminiKey.substring(0, 10) + '...</div>';
                return geminiKey;
            } else {
                statusDiv.innerHTML = '<div class="result error">‚ùå No API Key Found</div>';
                return null;
            }
        }

        // Test direct Gemini API call
        async function testGeminiAPI() {
            const resultDiv = document.getElementById('geminiResult');
            resultDiv.innerHTML = '<div>üîÑ Testing Gemini API...</div>';
            
            const apiKey = checkAPIKey();
            if (!apiKey) {
                resultDiv.innerHTML = '<div class="result error">‚ùå No API key available</div>';
                return;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: "You are a helpful pregnancy assistant. Give a brief, encouraging response about staying healthy during pregnancy. Use emojis."
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0]?.content?.parts[0]?.text || 'No response generated';
                
                resultDiv.innerHTML = `
                    <div class="result success">‚úÖ Gemini API Working!</div>
                    <div class="result">
                        <strong>AI Response:</strong><br>
                        ${aiResponse}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">‚ùå API Error: ${error.message}</div>
                    <div class="result">Check your API key and internet connection.</div>
                `;
            }
        }

        // Test the enhanced pregnancy chatbot
        async function testChatbot() {
            const question = document.getElementById('testQuestion').value || "What should I eat during pregnancy?";
            const resultDiv = document.getElementById('chatbotResult');
            resultDiv.innerHTML = '<div>ü§ñ Processing question...</div>';

            // Simulate the smartChatbot logic
            const apiKey = 'AIzaSyB4hlnDPViOskpseVwHzi-JaO1UOFJqOWo';
            
            try {
                const pregnancyContext = `
You are MatriCare, a helpful pregnancy health assistant. Provide accurate, supportive information about pregnancy.
Always include appropriate emojis and maintain a warm, caring tone.
Add disclaimers for medical advice when discussing specific health concerns.
Keep responses concise but informative (300-400 words max).
Use bullet points and clear formatting when helpful.
Focus on being encouraging and supportive while being medically responsible.
                `;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `${pregnancyContext}

User Question: ${question}

Please provide a helpful, accurate response about pregnancy. Use emojis and clear formatting. Include medical disclaimers when appropriate.`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0]?.content?.parts[0]?.text || 'Sorry, I couldn\\'t generate a response.';
                
                resultDiv.innerHTML = `
                    <div class="result success">‚úÖ MatriCare AI Response:</div>
                    <div class="result" style="white-space: pre-line; background: white; border: 1px solid #ddd;">
                        ${aiResponse}
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        Generated by: Gemini Pro API | Confidence: High
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">‚ùå Error: ${error.message}</div>
                `;
            }
        }

        // Initialize on page load
        window.onload = function() {
            checkAPIKey();
        };
    </script>
</body>
</html>